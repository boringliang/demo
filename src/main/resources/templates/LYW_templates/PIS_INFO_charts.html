<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>Sleek - Admin Dashboard Template</title>

    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500|Poppins:400,500,600,700|Roboto:400,500"
          rel="stylesheet"/>
    <link href="https://cdn.materialdesignicons.com/3.0.39/css/materialdesignicons.min.css" rel="stylesheet"/>

    <!-- PLUGINS CSS STYLE -->
    <link href="../../static/assets/plugins/toaster/toastr.min.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/nprogress/nprogress.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/flag-icons/css/flag-icon.min.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/jvectormap/jquery-jvectormap-2.0.3.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/ladda/ladda.min.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/select2/css/select2.min.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/daterangepicker/daterangepicker.css" rel="stylesheet"/>

    <!-- SLEEK CSS -->
    <link id="sleek-css" rel="stylesheet" href="../../static/assets/css/sleek.css"/>


    <!-- FAVICON -->
    <link href="../../static/assets/img/favicon.png" rel="shortcut icon"/>

    <!--
      HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
    -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="../../static/assets/plugins/nprogress/nprogress.js"></script>
    <script src="../../static/assets/d3.js" charset="utf-8"></script>
    <script src="../../static/assets/d3.min.js" charset="utf-8"></script>
    <script src="../../static/assets/echarts.min.js"></script>
    <script src="../../static/assets/js/echarts-gl.min.js"></script>


    <script src="../../static/assets/plugins/jquery/jquery.min.js"></script>
    <script src="../../static/assets/widgets/code/jquery.calendar.js"></script>
    <script src="../../static/assets/widgets/code/jquery.popup.js"></script>
    <script src="../../static/assets/LYWutils_traffic_jam.js"></script>
    <!--    <script charset="utf-8" src="https://map.qq.com/api/js?v=2.exp&key=PUBBZ-ED365-YF4IE-QAFHX-EE6M2-UVFFI"></script>-->
    <script src="../../static/assets/sidebar.js"></script>
    <style type="text/css">
        .calendar {
            width: 350px;
            margin: 0 auto 20px;
            color: #000000;
            background: #FFFFFF;
        }

        .calendar table {
            width: 100%;
            table-layout: fixed;
            border-collapse: collapse;
            border-spacing: 0;
            text-align: center;
        }

        .calendar caption {
            line-height: 30px;
            text-align: center;
            border-bottom: 1px solid #ebebeb;
            margin-bottom: 5px;
        }

        .calendar caption span {
            margin: 0 10px;
        }

        .calendar caption a {
            color: #666;
            margin: 0 5px;
            text-decoration: none;
        }

        .calendar td, .calendar th {
            height: 30px;
            line-height: 30px;
            text-align: center;
        }

        .calendar td span {
            display: block;
            width: 30px;
            margin: 0 auto;
            cursor: pointer;
        }

        .calendar .widget-back {
            float: right;
        }

        .calendar .widget-today span {
            font-weight: bold;
        }

        .calendar .widget-disabled span {
            color: #999;
        }

        .calendar .widget-highlight span {
            background: #f7b82e;
            color: #fff;
            border-radius: 30px;
        }

        .calendar .widget-active span {
            background: #39c;
            color: #fff;
            border-radius: 30px;
        }
    </style>


</head>


<body class="sidebar-fixed sidebar-dark header-light header-fixed" id="body">
<script>
    NProgress.configure({showSpinner: false});
    NProgress.start();
</script>

<div class="mobile-sticky-body-overlay"></div>

<div class="wrapper">

    <!--
====================================
——— LEFT SIDEBAR WITH FOOTER
=====================================
-->


    <div class="page-wrapper">
        <!-- Header -->
        <header class="main-header " id="header">
            <nav class="navbar navbar-static-top navbar-expand-lg">
                <!-- Sidebar toggle button -->
                <button id="sidebar-toggler" class="sidebar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                </button>
                <!-- search form -->
                <div class="search-form d-none d-lg-inline-block">
                    <div class="input-group">
                        <button type="button" name="search" id="search-btn" class="btn btn-flat">
                            <i class="mdi mdi-magnify"></i>
                        </button>
                        <input type="text" name="query" id="search-input" class="form-control"
                               placeholder="'button', 'chart' etc." autofocus autocomplete="off"/>
                    </div>
                    <div id="search-results-container">
                        <ul id="search-results"></ul>
                    </div>
                </div>

                <div class="navbar-right ">
                    <ul class="nav navbar-nav">
                        <!-- Github Link Button -->
                        <li class="github-link mr-3">
                            <a class="btn btn-outline-secondary btn-sm"
                               href="https://github.com/tafcoder/sleek-dashboard"
                               target="_blank">
                                <span class="d-none d-md-inline-block mr-2">Source Code</span>
                                <i class="mdi mdi-github-circle"></i>
                            </a>

                        </li>
                        <li class="dropdown notifications-menu">
                            <button class="dropdown-toggle" data-toggle="dropdown">
                                <i class="mdi mdi-bell-outline"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <li class="dropdown-header">You have 5 notifications</li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-account-plus"></i> New user registered
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 10
                        AM</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-account-remove"></i> User deleted
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 07
                        AM</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-chart-areaspline"></i> Sales report is ready
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 12
                        PM</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-account-supervisor"></i> New client
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 10
                        AM</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-server-network-off"></i> Server overloaded
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 05
                        AM</span>
                                    </a>
                                </li>
                                <li class="dropdown-footer">
                                    <a class="text-center" href="#"> View All </a>
                                </li>
                            </ul>
                        </li>
                        <!-- User Account -->
                        <li class="dropdown user-menu">
                            <button href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                                <img src="../../static/assets/img/user/user.png" class="user-image" alt="User Image"/>
                                <span class="d-none d-lg-inline-block">Abdus Salam</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <!-- User image -->
                                <li class="dropdown-header">
                                    <img src="../../static/assets/img/user/user.png" class="img-circle"
                                         alt="User Image"/>
                                    <div class="d-inline-block">
                                        Abdus Salam <small class="pt-1">abdus@gmail.com</small>
                                    </div>
                                </li>

                                <li>
                                    <a href="profile.html">
                                        <i class="mdi mdi-account"></i> My Profile
                                    </a>
                                </li>
                                <li>
                                    <a href="email-inbox.html">
                                        <i class="mdi mdi-email"></i> Message
                                    </a>
                                </li>
                                <li>
                                    <a href="#"> <i class="mdi mdi-diamond-stone"></i> Projects </a>
                                </li>
                                <li>
                                    <a href="#"> <i class="mdi mdi-settings"></i> Account Setting </a>
                                </li>

                                <li class="dropdown-footer">
                                    <a href="signin.html"> <i class="mdi mdi-logout"></i> Log Out </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>


        </header>


        <div class="content-wrapper">
            <div class="content">


                <div class="selections">

                    <select class="INFO_TYPE" multiple="multiple" size="3">
                        <option>情报类型</option>
                        <option value="01">01交通拥堵</option>
                        <option value="02">02交通违法</option>
                        <option value="03">03交通事故</option>
                        <option value="04">04信息咨询</option>
                        <option value="05">05交通设施</option>
                        <option value="06">06危难求助</option>
                        <option value="07">07突发事件</option>
                        <option value="08">08反映情况</option>
                        <option value="09">09秩序整治</option>
                        <option value="10">10其它</option>
                        <option value="11">11交通管制</option>
                        <option value="12">12恶劣天气</option>
                        <option value="13">13交通规划</option>
                        <option value="14">14交办任务</option>
                    </select>
                    <select class="INFO_LEVEL" multiple="multiple" size="3">
                        <option>情报级别</option>
                        <option value="1">1重大警情</option>
                        <option value="2">2较大警情</option>
                        <option value="3">3一般警情</option>
                        <option value="4">4轻微警情</option>
                    </select>
                    <button class="INFO_TIME">情报发生时间|
                        <div class="calendar"></div>
                    </button>
                    <button class="submit">submit</button>
                </div>

                <div class="content-wrapper">

                    <div class="col-xl-12 col-sm-12">
                        <div class="card card-mini mb-4">
                            <div class="card-body">
                                <h2 class="mb-1">情报总体数量统计</h2>
                                <div id="bar3d" style="height: 300px;">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="col-xl-6 col-sm-6" style="float: left">
                            <div class="card card-mini mb-4">
                                <div class="card-body">
                                    <h2 class="mb-1">情报类型数量统计</h2>
                                    <div id="info_type" style="height: 300px;">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-6 col-sm-6" style="float: left">
                            <div class="card card-mini mb-4">
                                <div class="card-body">
                                    <h2 class="mb-1">情报等级数量统计</h2>
                                    <div id="info_level" style="height: 300px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-12 col-sm-12">
                        <div class="card card-mini mb-4">
                            <div class="card-body">
                                <h2 class="mb-1">情报数量区域分布</h2>
                                <div id="info_departmentid" style="height: 300px;">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <script>
                INFO_TYPE_TABLE = new Object();
                INFO_TYPE_TABLE['01'] = '交通拥堵';
                INFO_TYPE_TABLE['02'] = '交通违法';
                INFO_TYPE_TABLE['03'] = '交通事故';
                INFO_TYPE_TABLE['04'] = '信息咨询';
                INFO_TYPE_TABLE['05'] = '交通设施';
                INFO_TYPE_TABLE['06'] = '危难求助';
                INFO_TYPE_TABLE['07'] = '突发事件';
                INFO_TYPE_TABLE['08'] = '反映情况';
                INFO_TYPE_TABLE['09'] = '秩序整治';
                INFO_TYPE_TABLE['10'] = '其它';
                INFO_TYPE_TABLE['11'] = '交通管制';
                INFO_TYPE_TABLE['12'] = '恶劣天气';
                INFO_TYPE_TABLE['13'] = '交通规划';
                INFO_TYPE_TABLE['14'] = '交办任务';

                INFO_LEVEL_TABLE = new Object();
                INFO_LEVEL_TABLE['1'] = '重大警情';
                INFO_LEVEL_TABLE['2'] = '较大警情';
                INFO_LEVEL_TABLE['3'] = '一般警情';
                INFO_LEVEL_TABLE['4'] = '轻微警情';


                //日历
                $('.content .selections .INFO_TIME .calendar').calendar({
                    limitRange: [['20191022', '20200610']],
                    isRange: true,
                    'onSelect': function (range) {
                        begin_time = range[0];
                        end_time = range[range.length - 1];
                    }
                });
                $('.content .selections').popup({
                    trigger: '.INFO_TIME',
                    triggerType: 'mouse',
                    node: '.calendar'
                });
                //ajax把数据库传过来的情报数据放在intelligence那个div里面
                //并画图展示情报大概情况
                $(document).ready(function () {
                    $('.selections').on('click', '.submit', function () {
                        var begin = begin_time['year'] + '-' + begin_time['month'] + '-' + begin_time['day'];
                        var end = end_time['year'] + '-' + end_time['month'] + '-' + end_time['day'];
                        $.ajax({
                            url: "/PIS_INFO_charts_ajax",
                            type: "POST",
                            data: {
                                // "SECTIONID": $('.LRX-ANLYS_GS_SECTION_COMPUTE .SECTIONID').val().toString(),
                                "begin_time": begin,
                                "end_time": end,
                                "INFO_TYPE": $('.selections .INFO_TYPE').val().toString(),
                                "INFO_LEVEL": $('.selections .INFO_LEVEL').val().toString(),
                            },
                            success: function (data) {
                                // add_to_intelligence(data);
                                // $('.content-wrapper').remove('#bar3d');
                                // $('.content-wrapper').append('<div id="bar3d"></div>');
                                // $('#bar3d').css("height", "300px");
                                // $('#bar3d').css("weight", "200px");
                                bar3d("情报类型", "情报级别", "情报数量", data2enum(data["INFO_TYPE_FOR_COUNT"], INFO_TYPE_TABLE), data2enum(data["INFO_LEVEL_FOR_COUNT"], INFO_LEVEL_TABLE), data["INFO_COUNT"], "bar3d");
                                pie_bar("情报类型", "情报数量", Object.keys(getMap(data2enum(data["INFO_TYPE"], INFO_TYPE_TABLE))), Object.values(getMap(data2enum(data["INFO_TYPE"], INFO_TYPE_TABLE))), "pie", "info_type");
                                pie_bar("情报级别", "情报数量", Object.keys(getMap(data2enum(data["INFO_LEVEL"], INFO_LEVEL_TABLE))), Object.values(getMap(data2enum(data["INFO_LEVEL"], INFO_LEVEL_TABLE))), "pie", "info_level");
                                pie_bar("辖区编号", "情报数量", Object.keys(getMap(data["INFO_departmentid"])), Object.values(getMap(data["INFO_departmentid"])), "bar", "info_departmentid");
                                // scatter_line("1", "2", data["INFO_TYPE_FOR_COUNT"], data["INFO_COUNT"], "bar3d");
                            },
                            fail: function () {
                                alert("error");
                            }
                        })
                    })
                })

                //functions
                function add_to_intelligence(data) {
                    $('.intelligence').html("");
                    for (var i = 0; i < data["INFO_TIME"].length; i++) {
                        $(".intelligence").append('<div id="PIS_INFO" class="PIS_INFO' + i + '"></div>');
                        $(".PIS_INFO" + i).append('<p>情报时间：' + data["INFO_TIME"][i] + '</p>');
                        $(".PIS_INFO" + i).append('<p>情报类型：' + INFO_TYPE_TABLE[data["INFO_TYPE"][i]] + '</p>');
                        $(".PIS_INFO" + i).append('<p>情报级别：' + INFO_LEVEL_TABLE[data["INFO_LEVEL"][i]] + '</p>');
                        $(".PIS_INFO" + i).append('<p id="address" class="' + data["INFO_ADDRESS"][i] + '">情报地址：' + data["INFO_ADDRESS"][i] + '</p>');
                        $(".PIS_INFO" + i).append('<p>情报主题：' + data["INFO_TOPIC"][i] + '</p>');
                        $(".intelligence").append('<hr/>');
                        // $(".testcss").css("height", "100px");
                        // $(".intelligence").append('<div id="PIS_INFO" class="' + data["INFO_ADDRESS"][i] + '"></div>');
                        // $("." + data["INFO_ADDRESS"][i]).append('<p>情报时间：' + data["INFO_TIME"][i] + '</p>');
                        // $("." + data["INFO_ADDRESS"][i]).append('<p>情报类型：' + INFO_TYPE_TABLE[data["INFO_TYPE"][i]] + '</p>');
                        // $("." + data["INFO_ADDRESS"][i]).append('<p>情报级别：' + INFO_LEVEL_TABLE[data["INFO_LEVEL"][i]] + '</p>');
                        // $("." + data["INFO_ADDRESS"][i]).append('<p>情报地址：' + data["INFO_ADDRESS"][i] + '</p>');
                        // $("." + data["INFO_ADDRESS"][i]).append('<p>情报主题：' + data["INFO_TOPIC"][i] + '</p>');
                        // $(".intelligence").append('<hr/>');
                    }
                }

                $(".intelligence").on('click', '#PIS_INFO', function () {
                    // map.panTo(new qq.maps.LatLng(Math.random()*51+3, Math.random()*63+73));
                    var address = $(this).find('#address').attr('class');
                    geocoder.getLocation(address);
                    // $.ajax({
                    //     url: "https://apis.map.qq.com/ws/place/v1/search",
                    //     type: "GET",
                    //     data: {
                    //         "keyword": address,
                    //         "boundary": "region(青岛,0)",
                    //         "key": "PUBBZ-ED365-YF4IE-QAFHX-EE6M2-UVFFI"
                    //     },
                    //     headers: {
                    //         "Access-Control-Allow-Origin": "*"
                    //     },
                    //     dataType: "jsonp",
                    //     success: function(data) {
                    //         var marker0 = new qq.maps.Marker( {
                    //             position: new qq.maps.LatLng(data[0]["location"]["lat"],data[0]["location"]["lng"]),
                    //             map: map
                    //         })
                    //         var marker1 = new qq.maps.Marker( {
                    //             position: new qq.maps.LatLng(data[1]["location"]["lat"],data[1]["location"]["lng"]),
                    //             map: map
                    //         })
                    //         var marker2 = new qq.maps.Marker( {
                    //             position: new qq.maps.LatLng(data[2]["location"]["lat"],data[2]["location"]["lng"]),
                    //             map: map
                    //         })
                    //     }
                    // })
                })
            </script>
        </div>
    </div>


</div>

</div>


<script src="../../static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../static/assets/plugins/toaster/toastr.min.js"></script>
<script src="../../static/assets/plugins/slimscrollbar/jquery.slimscroll.min.js"></script>
<script src="../../static/assets/plugins/charts/Chart.min.js"></script>
<script src="../../static/assets/plugins/ladda/spin.min.js"></script>
<script src="../../static/assets/plugins/ladda/ladda.min.js"></script>
<script src="../../static/assets/plugins/jquery-mask-input/jquery.mask.min.js"></script>
<script src="../../static/assets/plugins/select2/js/select2.min.js"></script>
<script src="../../static/assets/plugins/jvectormap/jquery-jvectormap-2.0.3.min.js"></script>
<script src="../../static/assets/plugins/jvectormap/jquery-jvectormap-world-mill.js"></script>
<script src="../../static/assets/plugins/daterangepicker/moment.min.js"></script>
<script src="../../static/assets/plugins/daterangepicker/daterangepicker.js"></script>
<script src="../../static/assets/plugins/jekyll-search.min.js"></script>
<script src="../../static/assets/js/sleek.js"></script>
<script src="../../static/assets/js/chart.js"></script>
<script src="../../static/assets/js/date-range.js"></script>
<script src="../../static/assets/js/map.js"></script>
<script src="../../static/assets/js/custom.js"></script>


<!--<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>-->


</body>

</html>