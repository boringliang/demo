<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>Sleek - Admin Dashboard Template</title>

    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500|Poppins:400,500,600,700|Roboto:400,500"
          rel="stylesheet"/>
    <link href="https://cdn.materialdesignicons.com/3.0.39/css/materialdesignicons.min.css" rel="stylesheet"/>

    <!-- PLUGINS CSS STYLE -->
    <link href="../../static/assets/plugins/toaster/toastr.min.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/nprogress/nprogress.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/flag-icons/css/flag-icon.min.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/jvectormap/jquery-jvectormap-2.0.3.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/ladda/ladda.min.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/select2/css/select2.min.css" rel="stylesheet"/>
    <link href="../../static/assets/plugins/daterangepicker/daterangepicker.css" rel="stylesheet"/>

    <!-- SLEEK CSS -->
    <link id="sleek-css" rel="stylesheet" href="../../static/assets/css/sleek.css"/>


    <!-- FAVICON -->
    <link href="../../static/assets/img/favicon.png" rel="shortcut icon"/>

    <!--
      HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
    -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="../../static/assets/plugins/nprogress/nprogress.js"></script>
<!--    <script src="../../static/assets/d3.js" charset="utf-8"></script>-->
<!--    <script src="../../static/assets/d3.min.js" charset="utf-8"></script>-->
    <script src="../../static/assets/js/echarts.min.js"></script>
<!--    <script src="../../static/assets/js/echarts-gl.min.js"></script>-->


    <script src="../../static/assets/plugins/jquery/jquery.min.js"></script>
<!--    <script src="../../static/assets/widgets/code/jquery.calendar.js"></script>-->
<!--    <script src="../../static/assets/widgets/code/jquery.popup.js"></script>-->
<!--    <script src="../../static/assets/LYWutils_traffic_jam.js"></script>-->
    <!--    <script charset="utf-8" src="https://map.qq.com/api/js?v=2.exp&key=PUBBZ-ED365-YF4IE-QAFHX-EE6M2-UVFFI"></script>-->
    <script src="../../static/assets/js/lyw/sidebar.js"></script>
    <script src="../../static/assets/js/vue.min.js"></script>
    <script src="../../static/assets/js/elementui.js"></script>
    <!--    <script src="../../static/assets/css/elementui.css"></script>-->
    <link href="../../static/assets/css/elementui.css" rel="stylesheet"/>

</head>


<body class="sidebar-fixed sidebar-dark header-light header-fixed" id="body">
<script>
    NProgress.configure({showSpinner: false});
    NProgress.start();
</script>

<div class="mobile-sticky-body-overlay"></div>

<div class="wrapper">

    <!--
====================================
——— LEFT SIDEBAR WITH FOOTER
=====================================
-->


    <div class="page-wrapper" style="overflow: auto; width: 1600px; height: 100%">
        <!-- Header -->
        <header class="main-header " id="header">
            <nav class="navbar navbar-static-top navbar-expand-lg">
                <!-- Sidebar toggle button -->
                <button id="sidebar-toggler" class="sidebar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                </button>
                <!-- search form -->
                <div class="search-form d-none d-lg-inline-block">
                    <div class="input-group">
                        <button type="button" name="search" id="search-btn" class="btn btn-flat">
                            <i class="mdi mdi-magnify"></i>
                        </button>
                        <input type="text" name="query" id="search-input" class="form-control"
                               placeholder="'button', 'chart' etc." autofocus autocomplete="off"/>
                    </div>
                    <div id="search-results-container">
                        <ul id="search-results"></ul>
                    </div>
                </div>

                <div class="navbar-right ">
                    <ul class="nav navbar-nav">
                        <!-- Github Link Button -->
                        <li class="github-link mr-3">
                            <a class="btn btn-outline-secondary btn-sm"
                               href="https://github.com/tafcoder/sleek-dashboard"
                               target="_blank">
                                <span class="d-none d-md-inline-block mr-2">Source Code</span>
                                <i class="mdi mdi-github-circle"></i>
                            </a>

                        </li>
                        <li class="dropdown notifications-menu">
                            <button class="dropdown-toggle" data-toggle="dropdown">
                                <i class="mdi mdi-bell-outline"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <li class="dropdown-header">You have 5 notifications</li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-account-plus"></i> New user registered
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 10
                        AM</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-account-remove"></i> User deleted
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 07
                        AM</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-chart-areaspline"></i> Sales report is ready
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 12
                        PM</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-account-supervisor"></i> New client
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 10
                        AM</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="mdi mdi-server-network-off"></i> Server overloaded
                                        <span class=" font-size-12 d-inline-block float-right"><i
                                                class="mdi mdi-clock-outline"></i> 05
                        AM</span>
                                    </a>
                                </li>
                                <li class="dropdown-footer">
                                    <a class="text-center" href="#"> View All </a>
                                </li>
                            </ul>
                        </li>
                        <!-- User Account -->
                        <li class="dropdown user-menu">
                            <button href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                                <img src="../../static/assets/img/user/user.png" class="user-image" alt="User Image"/>
                                <span class="d-none d-lg-inline-block">Abdus Salam</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <!-- User image -->
                                <li class="dropdown-header">
                                    <img src="../../static/assets/img/user/user.png" class="img-circle"
                                         alt="User Image"/>
                                    <div class="d-inline-block">
                                        Abdus Salam <small class="pt-1">abdus@gmail.com</small>
                                    </div>
                                </li>

                                <li>
                                    <a href="profile.html">
                                        <i class="mdi mdi-account"></i> My Profile
                                    </a>
                                </li>
                                <li>
                                    <a href="email-inbox.html">
                                        <i class="mdi mdi-email"></i> Message
                                    </a>
                                </li>
                                <li>
                                    <a href="#"> <i class="mdi mdi-diamond-stone"></i> Projects </a>
                                </li>
                                <li>
                                    <a href="#"> <i class="mdi mdi-settings"></i> Account Setting </a>
                                </li>

                                <li class="dropdown-footer">
                                    <a href="signin.html"> <i class="mdi mdi-logout"></i> Log Out </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>


        </header>


        <div class="content-wrapper">
            <div id="content">
                <template id="drawer">
                    <el-drawer
                            title="该点及其相似点的集合如下"
                            :visible.sync="table"
                            direction="rtl"
                            size="50%">
                        <el-table
                                :data="gridData"
                                height="500"
                                border
                                style="width: 100%">
                            <el-table-column type="expand">
                                <template slot-scope="props">
                                    <el-form label-position="left" inline class="demo-table-expand">
                                        <el-form-item label="行政区划">
                                            <span>{{ props.row.xzqh }}</span>
                                        </el-form-item>
                                        <el-form-item label="路号">
                                            <span>{{ props.row.lh }}</span>
                                        </el-form-item>
                                        <el-form-item label="路名">
                                            <span>{{ props.row.lm }}</span>
                                        </el-form-item>
                                        <el-form-item label="中央隔离设施">
                                            <span>{{ props.row.zyglss }}</span>
                                        </el-form-item>
                                        <el-form-item label="道路安全属性">
                                            <span>{{ props.row.dlaqsx }}</span>
                                        </el-form-item>
                                        <el-form-item label="交通信号方式">
                                            <span>{{ props.row.jtxhfs }}</span>
                                        </el-form-item>
                                        <el-form-item label="路侧防护设施类型">
                                            <span>{{ props.row.fhsslx }}</span>
                                        </el-form-item>
                                        <el-form-item label="路表情况">
                                            <span>{{ props.row.lbqk }}</span>
                                        </el-form-item>
                                        <el-form-item label="道路线性">
                                            <span>{{ props.row.dlxx }}</span>
                                        </el-form-item>
                                        <el-form-item label="事故初查原因分类">
                                            <span>{{ props.row.ccyyfl }}</span>
                                        </el-form-item>
                                        <el-form-item label="天气">
                                            <span>{{ props.row.tq }}</span>
                                        </el-form-item>
                                        <el-form-item label="能见度">
                                            <span>{{ props.row.njd }}</span>
                                        </el-form-item>
                                        <el-form-item label="现场">
                                            <span>{{ props.row.xc }}</span>
                                        </el-form-item>
                                        <el-form-item label="碰撞方式">
                                            <span>{{ props.row.pzfs }}</span>
                                        </el-form-item>
                                        <el-form-item label="地形">
                                            <span>{{ props.row.dx }}</span>
                                        </el-form-item>
                                        <el-form-item label="照明条件">
                                            <span>{{ props.row.zmtj }}</span>
                                        </el-form-item>
                                        <el-form-item label="事故发生时间">
                                            <span>{{ props.row.sgfssj }}</span>
                                        </el-form-item>
                                        <el-form-item label="当场死亡人数">
                                            <span>{{ props.row.swrs }}</span>
                                        </el-form-item>
                                        <el-form-item label="公里数">
                                            <span>{{ props.row.gls }}</span>
                                        </el-form-item>
                                    </el-form>
                                </template>
                            </el-table-column>
                            <el-table-column
                                    prop="xzqh"
                                    label="行政区划"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="lh"
                                    label="路号"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="lm"
                                    label="路名"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="zyglss"
                                    label="中央隔离设施"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="dlaqsx"
                                    label="道路安全属性"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="jtxhfs"
                                    label="交通信号方式"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="fhsslx"
                                    label="路侧防护设施类型"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="lbqk"
                                    label="路表情况"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="dlxx"
                                    label="道路线性"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="ccyyfl"
                                    label="事故初查原因分类"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="tq"
                                    label="天气"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="njd"
                                    label="能见度"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="xc"
                                    label="现场"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="pzfs"
                                    label="碰撞方式"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="dx"
                                    label="地形"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="zmtj"
                                    label="照明条件"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="sgffsj"
                                    label="事故发生时间"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="swrs"
                                    label="当场死亡人数"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                            <el-table-column
                                    prop="gls"
                                    label="公里数"
                                    sortable
                                    fixed
                                    width="100">
                            </el-table-column>
                        </el-table>
                    </el-drawer>
                </template>
                <template id="slide">
                    <div class="block">
                        <span class="demonstration">相异度</span>
<!--                        </span><button @click="graph">生成图</button>-->
                        <el-slider v-model="value" :format-tooltip="formatTooltip"></el-slider>
                    </div>
                </template>
                <template id="time_slide">
                    <div class="block">
                        <span class="demonstration">每日时间选择</span>
                        <el-slider v-model="value" range :max="86400" :format-tooltip="formatTooltip"></el-slider>
                    </div>
                </template>
                <template id="calendar">
                    <div class="block">
                        <span class="demonstration">时间</span>
                        <el-date-picker
                                v-model="value"
                                type="datetimerange"
                                range-separator="至"
                                start-placeholder="开始日期"
                                end-placeholder="结束日期">
                        </el-date-picker>
                    </div>
                </template>
                <!--<template id="selections">-->
                    <!--<el-select-->
                            <!--v-model="value"-->
                            <!--clearable-->
                            <!--multiple-->
                            <!--collapse-tags-->
                            <!--style="margin-left: 20px;"-->
                            <!--placeholder="请选择违法地点">-->
                        <!--<el-option-->
                                <!--v-for="item in options"-->
                                <!--:key="item.value"-->
                                <!--:label="item.label"-->
                                <!--:value="item.value">-->
                        <!--</el-option>-->
                    <!--</el-select>-->
                <!--</template>-->
                <div id="graph" style="height: 500px; width: 100%"></div>
                <template id="table" v-if=false>
                    <el-table
                            :data="tableData"
                            height="500"
                            border
                            style="width: 100%">
                        <el-table-column type="expand">
                            <template slot-scope="props">
                                <el-form label-position="left" inline class="demo-table-expand">
                                    <el-form-item label="行政区划">
                                        <span>{{ props.row.xzqh }}</span>
                                    </el-form-item>
                                    <el-form-item label="路号">
                                        <span>{{ props.row.lh }}</span>
                                    </el-form-item>
                                    <el-form-item label="路名">
                                        <span>{{ props.row.lm }}</span>
                                    </el-form-item>
                                    <el-form-item label="中央隔离设施">
                                        <span>{{ props.row.zyglss }}</span>
                                    </el-form-item>
                                    <el-form-item label="道路安全属性">
                                        <span>{{ props.row.dlaqsx }}</span>
                                    </el-form-item>
                                    <el-form-item label="交通信号方式">
                                        <span>{{ props.row.jtxhfs }}</span>
                                    </el-form-item>
                                    <el-form-item label="路侧防护设施类型">
                                        <span>{{ props.row.fhsslx }}</span>
                                    </el-form-item>
                                    <el-form-item label="路表情况">
                                        <span>{{ props.row.lbqk }}</span>
                                    </el-form-item>
                                    <el-form-item label="道路线性">
                                        <span>{{ props.row.dlxx }}</span>
                                    </el-form-item>
                                    <el-form-item label="事故初查原因分类">
                                        <span>{{ props.row.ccyyfl }}</span>
                                    </el-form-item>
                                    <el-form-item label="天气">
                                        <span>{{ props.row.tq }}</span>
                                    </el-form-item>
                                    <el-form-item label="能见度">
                                        <span>{{ props.row.njd }}</span>
                                    </el-form-item>
                                    <el-form-item label="现场">
                                        <span>{{ props.row.xc }}</span>
                                    </el-form-item>
                                    <el-form-item label="碰撞方式">
                                        <span>{{ props.row.pzfs }}</span>
                                    </el-form-item>
                                    <el-form-item label="地形">
                                        <span>{{ props.row.dx }}</span>
                                    </el-form-item>
                                    <el-form-item label="照明条件">
                                        <span>{{ props.row.zmtj }}</span>
                                    </el-form-item>
                                    <el-form-item label="事故发生时间">
                                        <span>{{ props.row.sgfssj }}</span>
                                    </el-form-item>
                                    <el-form-item label="当场死亡人数">
                                        <span>{{ props.row.swrs }}</span>
                                    </el-form-item>
                                    <el-form-item label="公里数">
                                        <span>{{ props.row.gls }}</span>
                                    </el-form-item>
                                </el-form>
                            </template>
                        </el-table-column>
                        <el-table-column
                                prop="XZQH"
                                label="行政区划"
                                sortable
                                fixed
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="LH"
                                label="路号"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="LM"
                                label="路名"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="ZYGLSS"
                                label="中央隔离设施"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="DLAQSX"
                                label="道路安全属性"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="JTXHFS"
                                label="交通信号方式"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="FHSSLX"
                                label="路侧防护设施类型"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="LBQK"
                                label="路表情况"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="DLXX"
                                label="道路线性"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="CCYYFL"
                                label="事故初查原因分类"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="TQ"
                                label="天气"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="NJD"
                                label="能见度"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="XC"
                                label="现场"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="PZFS"
                                label="碰撞方式"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="DX"
                                label="地形"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="ZMTJ"
                                label="照明条件"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="SGFSSJ"
                                label="事故发生时间"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="SWRS"
                                label="当场死亡人数"
                                sortable
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="GLS"
                                label="公里数"
                                sortable
                                width="100">
                        </el-table-column>
                    </el-table>
                </template>
            </div>
            <script>
                links = new Array();
                datas = new Array();
                datass = new Array();
                table_data = new Array();
                //calendar的value是js的Date；slide的value是1到100的整数

                //下面是所有的Vue对象
                var drawer;
                if (undefined != drawer) {
                    drawer.$destroy();
                }
                var MainDrawer = {
                    data() {
                        return {
                            table: false,
                            dialog: false,
                            loading: false,
                            gridData: [],
                            form: {
                                name: '',
                                region: '',
                                date1: '',
                                date2: '',
                                delivery: false,
                                type: [],
                                resource: '',
                                desc: ''
                            },
                            formLabelWidth: '80px',
                            timer: null,
                        };
                    },
                    methods: {
                    }
                };
                var CtorDrawer = Vue.extend(MainDrawer);
                var drawer = new CtorDrawer().$mount('#drawer');

                var calendar;
                if (undefined != calendar) {
                    calendar.$destroy();
                }
                var MainCalendar = {
                    data() {
                        return {
                            value: [new Date(2020, 3, 10, 10, 10), new Date(2020, 5, 9, 10, 10)],
                        };
                    },
                    watch: {
                        value: function() {
                            $.ajax({
                                url: "VIOLATION_eventgraph_ajax",
                                type: "POST",
                                data: {
                                    "time1": calendar.value[0],
                                    "time2": calendar.value[1],
                                    "time_range1": timeSlide.formatTooltip(timeSlide.value[0]),
                                    "time_range2": timeSlide.formatTooltip(timeSlide.value[1]),
                                },
                                success: function(data) {

                                    selections.options = [];
                                    var temp = new Array();
                                    for (var i = 0; i < data.length; i++) {
                                        if (temp.indexOf(data[i].wfdd) === -1) {
                                            temp.push(data[i].wfdd);
                                        }
                                    }
                                    var tempt = new Array();
                                    for (var i = 0; i < temp.length; i++) {
                                        var a = new Object();
                                        a.value = temp[i];
                                        a.label = temp[i];
                                        tempt.push(a);
                                    }
                                    tempt.unshift({value: 'all', label: '全选'});
                                    selections.options = tempt;
                                    // datas = getObject(data);
                                    datas = data;
                                    links = new Array();
                                    for (var i = 0; i < datas.length; i++) {
                                        datas[i].value = 20;
                                        datas[i].name = datas[i].sgbh;
                                    }
                                    var matrix = new Array(datas.length);
                                    for (var i = 0; i < matrix.length; i++) {
                                        matrix[i] = new Array(datas.length);
                                    }
                                    for (var i = 0; i < datas.length; i++) {
                                        for (var j = 0; j < datas.length; j++) {
                                            if (i === j) {matrix[i][j] = 0;}
                                            else {
                                                var dis = dissimilarity(datas[i],datas[j]);
                                                matrix[i][j] = dis;
                                                // datas[i].value += 3;
                                                // datas[j].value += 3;
                                                if (dis < slide.value/100) {
                                                    links.push( {
                                                        source: datas[i].name,
                                                        target: datas[j].name,
                                                    });
                                                }
                                            }
                                        }
                                    }
                                    // alert(links)

                                    var myChart;
                                    if (undefined != myChart) {
                                        myChart.remove();
                                    }
                                    var myChart = echarts.init(
                                        document.getElementById('graph')
                                    )
                                    myChart.clear();
                                    // 分类集合
                                    // var categories = [
                                    //     {name: '学校'},
                                    //     {name: '属性'},
                                    //     {name: '其他'}
                                    // ]
                                    // 配置项
                                    var option = {
                                        // 提示框设置
                                        tooltip: {
                                            // 关闭提示框
                                            show: true,
                                            trigger: 'item',
                                            formatter(params) {
                                                var out = '';
                                                // for (p in params) {
                                                out += '<p>' + '行政区划:' + params.data.xzqh + '</p>';
                                                out += '<p>' + '路号:' + params.data.lh + '</p>';
                                                out += '<p>' + '路名:' + params.data.lm + '</p>';
                                                out += '<p>' + '中央隔离设施:' + params.data.zyglss + '</p>';
                                                out += '<p>' + '道路安全属性:' + params.data.dlaqsx + '</p>';
                                                out += '<p>' + '交通信号方式:' + params.data.jtxhfs + '</p>';
                                                out += '<p>' + '路侧防护设施类型:' + params.data.fhsslx + '</p>';
                                                out += '<p>' + '路表情况:' + params.data.lbqk + '</p>';
                                                out += '<p>' + '道路线性:' + params.data.dlxx + '</p>';
                                                out += '<p>' + '事故初查原因分类:' + params.data.ccyyfl + '</p>';
                                                out += '<p>' + '天气:' + params.data.tq + '</p>';
                                                out += '<p>' + '能见度:' + params.data.njd + '</p>';
                                                out += '<p>' + '现场:' + params.data.xc + '</p>';
                                                out += '<p>' + '碰撞方式:' + params.data.pzfs + '</p>';
                                                out += '<p>' + '地形:' + params.data.dx + '</p>';
                                                out += '<p>' + '照明条件:' + params.data.zmtj + '</p>';
                                                out += '<p>' + '事故发生时间:' + params.data.sgfssj + '</p>';
                                                out += '<p>' + '当场死亡人数:' + params.data.swrs + '</p>';
                                                out += '<p>' + '公里数:' + params.data.gls + '</p>';
                                                // }
                                                return out;
                                            }
                                        },
                                        // 图例设置
                                        // legend: [{
                                            // 纵向
                                            // orient: 'vertical',
                                            // 位置
                                            // left: 'right',
                                            // 图例内容，由上面的分类集合决定
                                            // data: categories.map(function (a) {
                                            //     return a.name;
                                            // })
                                        // }],
                                        // 数据设置
                                        series: [{
                                            // 类型
                                            type: 'graph',
                                            // 力导图布局
                                            layout: 'force',
                                            // 开启平移与缩放
                                            roam: true,
                                            // 标签设置
                                            // label: {
                                            //     normal: {
                                                    // 是否展示
                                                    // show: true,
                                                    // 展示位置
                                                    // position: 'top',
                                                    // 展示内容
                                                    // formatter: '{b}',
                                                    // 文本设置
                                                    // textStyle: {
                                                        // 文本大小
                                                        // fontSize: '12rem'
                                                    // },
                                                // }
                                            // },
                                            // 根据value放缩节点
                                            symbolSize: (value, params) => {
                                                return value;
                                            },
                                            // 是否可拖拽
                                            draggable: true,
                                            // 节点数据
                                            data: datas,

                                            force: {
                                                edgeLength: 200,
                                                repulsion: 300,
                                                // gravity: 0.1
                                            },
                                            // 关系
                                            links: links,
                                        }]
                                    };
                                    myChart.setOption(option);
                                    myChart.on('click', function(params) {
                                        return false;
                                    });
                                    myChart.on('click', function (params) {
                                        var similar_links = links.filter(
                                            (o) => {
                                                if ((o.target === params.name) || (o.source === params.name)) {
                                                    return o;
                                                }
                                            }
                                        )
                                        var similar_datas_name = new Set();
                                        for (var i = 0; i < similar_links.length; i++) {
                                            similar_datas_name.add(similar_links[i].source);
                                            similar_datas_name.add(similar_links[i].target);
                                        }
                                        var similar_datas_name = Array.from(similar_datas_name);
                                        var similar_datas = datas.filter(
                                            (o) => {
                                                if (similar_datas_name.indexOf(o.name) >= 0) {
                                                    return o;
                                                }
                                            }
                                        )
                                        drawer.gridData = similar_datas;
                                        drawer.table = true;
                                    });
                                }
                            })

                        }
                    }
                };
                var CtorCalendar = Vue.extend(MainCalendar);
                var calendar = new CtorCalendar().$mount('#calendar');

                var slide;
                if (undefined != slide) {
                    slide.$destroy();
                }
                var MainSlide = {
                    data() {
                        return {
                            value: 42
                        }
                    },
                    methods: {
                        formatTooltip(val) {
                            return val / 100;
                        },
                        graph:function() {
                            links = [];
                            var matrix = new Array(datas.length);
                            for (var i = 0; i < matrix.length; i++) {
                                matrix[i] = new Array(datas.length);
                            }
                            for (var i = 0; i < datas.length; i++) {
                                for (var j = 0; j < datas.length; j++) {
                                    if (i === j) {matrix[i][j] = 0;}
                                    else {
                                        var dis = dissimilarity(datas[i],datas[j]);
                                        matrix[i][j] = dis;
                                        // datas[i].value += 3;
                                        // datas[j].value += 3;
                                        if (dis < slide.value/100) {
                                            links.push( {
                                                source: datas[i].name,
                                                target: datas[j].name,
                                            });
                                        }
                                    }
                                }
                            }
                            // alert(links)
                            var myChart;
                            if (undefined != myChart) {
                                myChart.remove();
                            }

                            var myChart = echarts.init(
                                document.getElementById('graph')
                            )
                            myChart.clear();
                            var option = {
                                tooltip: {
                                    show: true,
                                    trigger: 'item',
                                    formatter(params) {
                                        var out = '';
                                        // for (p in params) {
                                        out += '<p>' + '行政区划:' + params.data.xzqh + '</p>';
                                        out += '<p>' + '路号:' + params.data.lh + '</p>';
                                        out += '<p>' + '路名:' + params.data.lm + '</p>';
                                        out += '<p>' + '中央隔离设施:' + params.data.zyglss + '</p>';
                                        out += '<p>' + '道路安全属性:' + params.data.dlaqsx + '</p>';
                                        out += '<p>' + '交通信号方式:' + params.data.jtxhfs + '</p>';
                                        out += '<p>' + '路侧防护设施类型:' + params.data.fhsslx + '</p>';
                                        out += '<p>' + '路表情况:' + params.data.lbqk + '</p>';
                                        out += '<p>' + '道路线性:' + params.data.dlxx + '</p>';
                                        out += '<p>' + '事故初查原因分类:' + params.data.ccyyfl + '</p>';
                                        out += '<p>' + '天气:' + params.data.tq + '</p>';
                                        out += '<p>' + '能见度:' + params.data.njd + '</p>';
                                        out += '<p>' + '现场:' + params.data.xc + '</p>';
                                        out += '<p>' + '碰撞方式:' + params.data.pzfs + '</p>';
                                        out += '<p>' + '地形:' + params.data.dx + '</p>';
                                        out += '<p>' + '照明条件:' + params.data.zmtj + '</p>';
                                        out += '<p>' + '事故发生时间:' + params.data.sgfssj + '</p>';
                                        out += '<p>' + '当场死亡人数:' + params.data.swrs + '</p>';
                                        out += '<p>' + '公里数:' + params.data.gls + '</p>';
                                        // }
                                        return out;
                                    }
                                },
                                series: [{
                                    type: 'graph',
                                    layout: 'force',
                                    roam: true,
                                    symbolSize: (value, params) => {
                                        return value;
                                    },
                                    draggable: true,
                                    data: datas,
                                    force: {
                                        edgeLength: 200,
                                        repulsion: 300,
                                    },
                                    links: links
                                }]
                            };
                            myChart.setOption(option);
                        }
                    },
                    watch: {
                        value: function() {
                            links = [];
                            if (datass.length === 0) {
                                for (var i = 0; i < datas.length; i++) {
                                    datass.push(datas[i]);
                                }
                            }
                            var matrix = new Array(datass.length);
                            for (var i = 0; i < matrix.length; i++) {
                                matrix[i] = new Array(datass.length);
                            }
                            for (var i = 0; i < datass.length; i++) {
                                for (var j = 0; j < datass.length; j++) {
                                    if (i === j) {matrix[i][j] = 0;}
                                    else {
                                        var dis = dissimilarity(datass[i],datass[j]);
                                        matrix[i][j] = dis;
                                        // datass[i].value += 3;
                                        // datass[j].value += 3;
                                        if (dis < slide.value/100) {
                                            links.push( {
                                                source: datass[i].name,
                                                target: datass[j].name,
                                            });
                                        }
                                    }
                                }
                            }
                            var myChart;
                            if (undefined != myChart) {
                                myChart.remove();
                            }

                            var myChart = echarts.init(
                                document.getElementById('graph')
                            )
                            myChart.clear();
                            var option = {
                                tooltip: {
                                    show: true,
                                    trigger: 'item',
                                    formatter(params) {
                                        var out = '';
                                        // for (p in params) {
                                        out += '<p>' + '行政区划:' + params.data.xzqh + '</p>';
                                        out += '<p>' + '路号:' + params.data.lh + '</p>';
                                        out += '<p>' + '路名:' + params.data.lm + '</p>';
                                        out += '<p>' + '中央隔离设施:' + params.data.zyglss + '</p>';
                                        out += '<p>' + '道路安全属性:' + params.data.dlaqsx + '</p>';
                                        out += '<p>' + '交通信号方式:' + params.data.jtxhfs + '</p>';
                                        out += '<p>' + '路侧防护设施类型:' + params.data.fhsslx + '</p>';
                                        out += '<p>' + '路表情况:' + params.data.lbqk + '</p>';
                                        out += '<p>' + '道路线性:' + params.data.dlxx + '</p>';
                                        out += '<p>' + '事故初查原因分类:' + params.data.ccyyfl + '</p>';
                                        out += '<p>' + '天气:' + params.data.tq + '</p>';
                                        out += '<p>' + '能见度:' + params.data.njd + '</p>';
                                        out += '<p>' + '现场:' + params.data.xc + '</p>';
                                        out += '<p>' + '碰撞方式:' + params.data.pzfs + '</p>';
                                        out += '<p>' + '地形:' + params.data.dx + '</p>';
                                        out += '<p>' + '照明条件:' + params.data.zmtj + '</p>';
                                        out += '<p>' + '事故发生时间:' + params.data.sgfssj + '</p>';
                                        out += '<p>' + '当场死亡人数:' + params.data.swrs + '</p>';
                                        out += '<p>' + '公里数:' + params.data.gls + '</p>';
                                        // }
                                        return out;
                                    }
                                },
                                series: [{
                                    type: 'graph',
                                    layout: 'force',
                                    roam: true,
                                    symbolSize: (value, params) => {
                                        return value;
                                    },
                                    draggable: true,
                                    data: datass,
                                    force: {
                                        edgeLength: 200,
                                        repulsion: 300,
                                    },
                                    links: links,
                                }]
                            };
                            myChart.setOption(option);
                        }
                    }
                }
                var CtorSlide = Vue.extend(MainSlide)
                var slide = new CtorSlide().$mount('#slide')

                var selections;
                if (undefined != selections) {
                    selections.$destroy();
                }
                var MainSelections = {
                    data() {
                        return {
                            options: [],
                            value: []
                        }
                    },
                    watch: {
                        value: function() {
                            links = [];
                            datass = [];
                            if (selections.value.indexOf('all') >= 0) {
                                for (var i = 0; i < datas.length; i++) {
                                    datass.push(datas[i]);
                                }
                            }
                            else {
                                for (var i = 0; i < datas.length; i++) {
                                    if (selections.value.indexOf(datas[i].wfdd) >= 0) {
                                        datass.push(datas[i]);
                                    }
                                }
                            }
                            var matrix = new Array(datass.length);
                            for (var i = 0; i < matrix.length; i++) {
                                matrix[i] = new Array(datass.length);
                            }
                            for (var i = 0; i < datass.length; i++) {
                                for (var j = 0; j < datass.length; j++) {
                                    if (i === j) {matrix[i][j] = 0;}
                                    else {
                                        var dis = dissimilarity(datass[i],datass[j]);
                                        matrix[i][j] = dis;
                                        // datass[i].value += 3;
                                        // datass[j].value += 3;
                                        if (dis < slide.value/100) {
                                            links.push( {
                                                source: datass[i].name,
                                                target: datass[j].name,
                                            });
                                        }
                                    }
                                }
                            }
                            var myChart;
                            if (undefined != myChart) {
                                myChart.remove();
                            }

                            var myChart = echarts.init(
                                document.getElementById('graph')
                            )
                            myChart.clear();
                            var option = {
                                tooltip: {
                                    show: true,
                                    trigger: 'item',
                                    formatter(params) {
                                        var out = '';
                                        // for (p in params) {
                                        out += '<p>' + '行政区划:' + params.data.xzqh + '</p>';
                                        out += '<p>' + '路号:' + params.data.lh + '</p>';
                                        out += '<p>' + '路名:' + params.data.lm + '</p>';
                                        out += '<p>' + '中央隔离设施:' + params.data.zyglss + '</p>';
                                        out += '<p>' + '道路安全属性:' + params.data.dlaqsx + '</p>';
                                        out += '<p>' + '交通信号方式:' + params.data.jtxhfs + '</p>';
                                        out += '<p>' + '路侧防护设施类型:' + params.data.fhsslx + '</p>';
                                        out += '<p>' + '路表情况:' + params.data.lbqk + '</p>';
                                        out += '<p>' + '道路线性:' + params.data.dlxx + '</p>';
                                        out += '<p>' + '事故初查原因分类:' + params.data.ccyyfl + '</p>';
                                        out += '<p>' + '天气:' + params.data.tq + '</p>';
                                        out += '<p>' + '能见度:' + params.data.njd + '</p>';
                                        out += '<p>' + '现场:' + params.data.xc + '</p>';
                                        out += '<p>' + '碰撞方式:' + params.data.pzfs + '</p>';
                                        out += '<p>' + '地形:' + params.data.dx + '</p>';
                                        out += '<p>' + '照明条件:' + params.data.zmtj + '</p>';
                                        out += '<p>' + '事故发生时间:' + params.data.sgfssj + '</p>';
                                        out += '<p>' + '当场死亡人数:' + params.data.swrs + '</p>';
                                        out += '<p>' + '公里数:' + params.data.gls + '</p>';
                                        // }
                                        return out;
                                    }
                                },
                                series: [{
                                    type: 'graph',
                                    layout: 'force',
                                    roam: true,
                                    symbolSize: (value, params) => {
                                        return value;
                                    },
                                    draggable: true,
                                    data: datass,
                                    force: {
                                        edgeLength: 200,
                                        repulsion: 300,
                                    },
                                    links: links,
                                }]
                            };
                            myChart.setOption(option);

                        }
                    }
                }
                var CtorSelections = Vue.extend(MainSelections)
                var selections = new CtorSelections().$mount('#selections')

                var timeSlide;
                if (undefined != timeSlide) {
                    timeSlide.$destroy();
                }
                var MainTimeSlide = {
                    data() {
                        return {
                            value: [1, 86400]
                        }
                    },
                    methods: {
                        formatTooltip(val) {
                            var hour = parseInt(val/3600);
                            var minute = parseInt((val%3600)/60);
                            var second = parseInt(val%60);
                            return hour + ':' + minute + ':' + second;
                        }
                    },
                    watch: {
                        value: function() {
                            $.ajax({
                                url: "VIOLATION_eventgraph_ajax",
                                type: "POST",
                                data: {
                                    // "times": calendar.value,
                                    // "dissimilarity": slide.value
                                    "time1": calendar.value[0],
                                    "time2": calendar.value[1],
                                    "time_range1": timeSlide.formatTooltip(timeSlide.value[0]),
                                    "time_range2": timeSlide.formatTooltip(timeSlide.value[1]),
                                },
                                success: function(data) {
                                    // var WFDDs = data["WFDDs"];
                                    var WFDDs = new Array();
                                    for (var i = 0; i < data.length; i++) {
                                        if (WFDDs.indexOf(data[i].wfdd) === -1) {
                                            WFDDs.push(data[i].wfdd);
                                        }
                                    }
                                    var wfdds = new Array();
                                    for (var i = 0; i < WFDDs.length; i++) {
                                        var o = new Object();
                                        o.value = WFDDs[i];
                                        o.label = o.value;
                                        wfdds.push(o);
                                    }
                                    selections.options = [];
                                    selections.options = wfdds;
                                    selections.options.unshift({
                                        value: 'all',
                                        label: '全选'
                                    });
                                    datas = data;
                                    links = new Array();
                                    for (var i = 0; i < datas.length; i++) {
                                        datas[i].value = 20;
                                        datas[i].name = datas[i].sgbh;
                                    }
                                    var matrix = new Array(datas.length);
                                    for (var i = 0; i < matrix.length; i++) {
                                        matrix[i] = new Array(datas.length);
                                    }
                                    for (var i = 0; i < datas.length; i++) {
                                        for (var j = 0; j < datas.length; j++) {
                                            if (i === j) {matrix[i][j] = 0;}
                                            else {
                                                var dis = dissimilarity(datas[i],datas[j]);
                                                matrix[i][j] = dis;
                                                if (dis < slide.value/100) {
                                                    links.push( {
                                                        source: datas[i].name,
                                                        target: datas[j].name,
                                                    });
                                                }
                                            }
                                        }
                                    }
                                    var myChart;
                                    if (undefined != myChart) {
                                        myChart.remove();
                                    }

                                    var myChart = echarts.init(
                                        document.getElementById('graph')
                                    )
                                    myChart.clear();
                                    var option = {
                                        tooltip: {
                                            show: true,
                                            trigger: 'item',
                                            formatter(params) {
                                                var out = '';
                                                // for (p in params) {
                                                out += '<p>' + '行政区划:' + params.data.xzqh + '</p>';
                                                out += '<p>' + '路号:' + params.data.lh + '</p>';
                                                out += '<p>' + '路名:' + params.data.lm + '</p>';
                                                out += '<p>' + '中央隔离设施:' + params.data.zyglss + '</p>';
                                                out += '<p>' + '道路安全属性:' + params.data.dlaqsx + '</p>';
                                                out += '<p>' + '交通信号方式:' + params.data.jtxhfs + '</p>';
                                                out += '<p>' + '路侧防护设施类型:' + params.data.fhsslx + '</p>';
                                                out += '<p>' + '路表情况:' + params.data.lbqk + '</p>';
                                                out += '<p>' + '道路线性:' + params.data.dlxx + '</p>';
                                                out += '<p>' + '事故初查原因分类:' + params.data.ccyyfl + '</p>';
                                                out += '<p>' + '天气:' + params.data.tq + '</p>';
                                                out += '<p>' + '能见度:' + params.data.njd + '</p>';
                                                out += '<p>' + '现场:' + params.data.xc + '</p>';
                                                out += '<p>' + '碰撞方式:' + params.data.pzfs + '</p>';
                                                out += '<p>' + '地形:' + params.data.dx + '</p>';
                                                out += '<p>' + '照明条件:' + params.data.zmtj + '</p>';
                                                out += '<p>' + '事故发生时间:' + params.data.sgfssj + '</p>';
                                                out += '<p>' + '当场死亡人数:' + params.data.swrs + '</p>';
                                                out += '<p>' + '公里数:' + params.data.gls + '</p>';
                                                // }
                                                return out;
                                            }
                                        },
                                        series: [{
                                            type: 'graph',
                                            layout: 'force',
                                            roam: true,
                                            symbolSize: (value, params) => {
                                                return value;
                                            },
                                            draggable: true,
                                            data: datas,
                                            force: {
                                                edgeLength: 200,
                                                repulsion: 300,
                                                // gravity: 0.1
                                            },
                                            links: links,
                                        }]
                                    };
                                    myChart.setOption(option);
                                }
                            })
                        }
                    }
                }
                var CtorTimeSlide = Vue.extend(MainTimeSlide)
                var timeSlide = new CtorTimeSlide().$mount('#time_slide')

                var table = new Vue({
                    el: '#table',
                    data:
                        {
                            message: "",
                            tableData: []
                        },
                });

                //下面是所有的函数和表
                CATAGORY_SIMILARITY_LIST = new Array("xzqh","lh","lm","zyglss","dlaqsx","jtxhfs","fhsslx","lbqk","dlxx","ccyyfl","tq","njd","xc","pzfs","dx","zmtj");
                NUMERICAL_SIMILARITY_LIST = new Array("sgfssj","swrs","gls");
                MAX_DATE = new Date('2020-06-09 06:55:00');
                MIN_DATE = new Date('2020-04-10 18:47:00');
                MIN_SWRS = 0;
                MAX_SWRS = 3;
                MIN_GLS = 0;
                MAX_GLS = 9001;

                function dissimilarity(violation1, violation2) {
                    //param: 事件的Object
                    //return: 两个事件的相异度，取值从0到1
                    var denominator = 0;
                    var numerator = 0;
                    for (var i = 0; i < CATAGORY_SIMILARITY_LIST.length; i++) {
                        denominator++;
                        violation1[CATAGORY_SIMILARITY_LIST[i]] === violation2[CATAGORY_SIMILARITY_LIST[i]] ? numerator+=0 : numerator+=1;
                    }
                    denominator += NUMERICAL_SIMILARITY_LIST.length;
                    var d1 = new Date(violation1.sgfssj);
                    var d2 = new Date(violation2.sgfssj);
                    numerator += Math.abs(d1-d2)/Math.abs(MIN_DATE-MAX_DATE);
                    numerator += Math.abs(parseInt(violation1.swrs)-parseInt(violation2.swrs))/Math.abs(MIN_SWRS-MAX_SWRS);
                    numerator += Math.abs(parseInt(violation1.gls)-parseInt(violation2.gls))/Math.abs(MIN_GLS-MAX_GLS);
                    return numerator/denominator;
                }
            </script>

        </div>
    </div>


</div>

</div>


<script src="../../static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../static/assets/plugins/toaster/toastr.min.js"></script>
<script src="../../static/assets/plugins/slimscrollbar/jquery.slimscroll.min.js"></script>
<script src="../../static/assets/plugins/charts/Chart.min.js"></script>
<script src="../../static/assets/plugins/ladda/spin.min.js"></script>
<script src="../../static/assets/plugins/ladda/ladda.min.js"></script>
<script src="../../static/assets/plugins/jquery-mask-input/jquery.mask.min.js"></script>
<script src="../../static/assets/plugins/select2/js/select2.min.js"></script>
<script src="../../static/assets/plugins/jvectormap/jquery-jvectormap-2.0.3.min.js"></script>
<script src="../../static/assets/plugins/jvectormap/jquery-jvectormap-world-mill.js"></script>
<script src="../../static/assets/plugins/daterangepicker/moment.min.js"></script>
<script src="../../static/assets/plugins/daterangepicker/daterangepicker.js"></script>
<script src="../../static/assets/plugins/jekyll-search.min.js"></script>
<script src="../../static/assets/js/sleek.js"></script>
<script src="../../static/assets/js/chart.js"></script>
<script src="../../static/assets/js/date-range.js"></script>
<script src="../../static/assets/js/map.js"></script>
<script src="../../static/assets/js/custom.js"></script>


<!--<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>-->


</body>

</html>